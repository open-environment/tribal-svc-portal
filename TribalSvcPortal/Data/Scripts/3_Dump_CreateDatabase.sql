/***************************************************************** */
/*************DROP EXISTING DATABASE (only use if refreshing DB*** */
/***************************************************************** */
/*
	USE [TRIBAL_SVC_PORTAL];

	drop table [T_OD_DUMP_ASSESSMENTS] ;
	drop table [T_OD_SITES];
	drop table [T_OD_REF_DATA];  
	drop table [T_OD_REF_DATA_CATEGORIES];


--BUILD SCAFFOLDING script (Open Packages Manager (under tools) and run this command:)
Scaffold-DbContext -UseDatabaseNames "Server=.\SQLEXPRESS;Database=TRIBAL_SVC_PORTAL;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Data/Models -t T_OD_REF_DATA_CATEGORIES, T_OD_REF_DATA, T_OD_SITES, T_OD_DUMP_ASSESSMENTS -f -Context "ApplicationDbContextTemp"
*/

use [TRIBAL_SVC_PORTAL]

CREATE TABLE [dbo].[T_OD_REF_DATA_CATEGORIES](
	[DATA_CAT_NAME] [VARCHAR](50) NOT NULL,
	[DATA_CAT_DESCRIPTION] [varchar](200) NULL,	
	[CREATE_USER_ID] nvarchar(450) NULL,
	[CREATE_DT] datetime2(0) NULL,
 CONSTRAINT [PK_T_OD_REF_DATA_CATEGORIES] PRIMARY KEY CLUSTERED  ([DATA_CAT_NAME] ASC)
) ON [PRIMARY]

GO


CREATE TABLE [dbo].[T_OD_REF_DATA](
	[DATA_IDX] [UNIQUEIDENTIFIER] NOT NULL DEFAULT NEWID(),
	[ORG_ID] varchar(30) NULL,
	[DATA_NAME] [VARCHAR](100) NOT NULL,
	[DATA_CAT_NAME] [VARCHAR](50) NOT NULL,
	[USER_CREATE_IND] [BIT] NOT NULL DEFAULT 0,
	[CREATE_USER_ID] nvarchar(450) NULL,
	[CREATE_DT] datetime2(0) NULL,
	[MODIFY_USER_ID] nvarchar(450) NULL,
	[MODIFY_DT] datetime2(0) NULL,
 CONSTRAINT [PK_T_OD_REF_DATA] PRIMARY KEY CLUSTERED  ([DATA_IDX] ASC),
 FOREIGN KEY ([DATA_CAT_NAME]) REFERENCES [T_OD_REF_DATA_CATEGORIES] ([DATA_CAT_NAME])
) ON [PRIMARY]

GO


CREATE TABLE [T_OD_SITES] (
	[SITE_IDX] uniqueidentifier NOT NULL,
	[COMMUNITY_IDX] uniqueidentifier NOT NULL,
	[SITE_SETTING_IDX] uniqueidentifier NOT NULL,
	[REPORTED_BY] varchar(50) NULL,
	[REPORTED_ON] datetime2(0) NULL,
	[RESPONSE_ACTION] varchar(100) NOT NULL,
    CONSTRAINT [PK_T_OD_SITE_DTL] PRIMARY KEY ([SITE_IDX]),
    CONSTRAINT [FK_T_OD_SITE_DTL_S] FOREIGN KEY ([SITE_IDX]) REFERENCES [T_PRT_SITES] ([SITE_IDX]),
	CONSTRAINT [FK_T_OD_SITE_DTL_C] FOREIGN KEY ([COMMUNITY_IDX]) REFERENCES [T_OD_REF_DATA] ([DATA_IDX]),
    CONSTRAINT [FK_T_OD_SITE_DTL_SS] FOREIGN KEY ([SITE_SETTING_IDX]) REFERENCES [T_OD_REF_DATA] ([DATA_IDX])
);
GO



CREATE TABLE [T_OD_DUMP_ASSESSMENTS] 
(
	[DUMP_ASSESSMENTS_IDX] uniqueidentifier NOT NULL DEFAULT NEWID(),
	[SITE_IDX] uniqueidentifier NOT NULL,
	[ASSESSMENT_DT] datetime2(0) NOT NULL,
	[INSPECTED_BY] nvarchar(450) NULL,
	[INSPECTION_TYPE_IDX] uniqueidentifier NULL,
	[SITE_DESCRIPTION] nvarchar(450) NULL,
	[SITE_GEOGRAPHY] varchar(100) NULL,
	[NO_OF_STRUCTURES] varchar(100) NULL,
	[SITE_ACCESS] varchar(100) NULL,
	[SIGNAGE] varchar(100) NULL,
	[ACTIVE_SITE_IND] bit NOT NULL DEFAULT 0,
	[MAINTAINED_IND] bit NOT NULL DEFAULT 0,
	[BURNING_TAKEN_PLACE_IND] bit NOT NULL DEFAULT 0,
	[NOTES] nvarchar(400) NULL,
	[CREATE_USER_ID] nvarchar(450) NULL,
	[CREATE_DT] datetime2(0) NULL,
	[MODIFY_USER_ID] nvarchar(450) NULL,
	[MODIFY_DT] datetime2(0) NULL,
    CONSTRAINT [PK_T_OD_DUMP_ASSESSMENTS] PRIMARY KEY ([DUMP_ASSESSMENTS_IDX]),
    CONSTRAINT [FK_T_OD_DUMP_ASSESSMENTS_I] FOREIGN KEY ([INSPECTED_BY]) REFERENCES [T_PRT_USERS] ([Id]),
    CONSTRAINT [FK_T_OD_DUMP_ASSESSMENTS_S] FOREIGN KEY ([SITE_IDX]) REFERENCES [T_OD_SITES] ([SITE_IDX]),
    CONSTRAINT [FK_T_OD_DUMP_ASSESSMENTS_D] FOREIGN KEY ([INSPECTION_TYPE_IDX]) REFERENCES [T_OD_REF_DATA] ([DATA_IDX])
);